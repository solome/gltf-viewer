var A=Object.defineProperty;var B=(s,e,t)=>e in s?A(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var a=(s,e,t)=>(B(s,typeof e!="symbol"?e+"":e,t),t);import{V as q,G,S as j,W as $,s as H,P as V,a as z,D as Y,A as U,b as K,R as X,U as J,H as x,B as Q,c as Z,j as ee,r as k,d as te,e as ie}from"./vendor.8493b24e.js";const ne=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}};ne();function m(){return((1+Math.random())*65536|0).toString(16).substring(1)}function se(){return(m()+m()+"-"+m()+"-4"+m().substr(0,3)+"-"+m()+"-"+m()+m()+m()).toLowerCase()}const w=Symbol("$$LIVE_EVENT$$");function b(s){return s[w]||(s[w]={}),s[w]}function oe(s){s[w]||delete s[w]}class re{hasListener(e){const t=b(this);return t&&t[e]&&t[e].length>0}on(e,t,n){const i=b(this);return i[e]||(i[e]=[]),i[e].push([t,n||!1]),()=>this.off(e,t)}once(e,t){return this.on(e,t,!0)}off(e,t){if(e===void 0){oe(this);return}const n=b(this);if(n[e]||(n[e]=[]),t===void 0){n[e].length=0;return}let i=0;for(;i<n[e].length&&n[e][i][0]!==t;i++);i<n[e].length&&n[e].splice(i,1)}emit(e,...t){let n=!1;const o=b(this)[e]||[];for(let r of o.slice()){const[h,d=!1]=r,u=h(...t);d&&this.off(e,h),u===!1&&(n=!0)}return n}}const L=Math.PI*2;function D(s){return(s%L+L)%L}const y=window,F=window.requestAnimationFrame||y.mozRequestAnimationFrame||y.webkitRequestAnimationFrame||y.msRequestAnimationFrame||(s=>setTimeout(s,16)),P={duration:0};function I(s){P.duration&&s(P.duration);const e=Date.now();F(()=>{s(P.duration=Date.now()-e)})}I(()=>{});function O({longitude:s,latitude:e}){const t=Math.abs(Math.cos(e));return new q(-Math.sin(s)*t,-Math.sin(e),-Math.cos(s)*t)}function N(s,e,t){let{longitude:n,latitude:i}=s;return n=n-e.x/t.width*3,i=i-e.y/t.height*3,n=D(n),{longitude:n,latitude:i}}const ae=document,he=window,v=ae.mozFullScreen?"DOMMouseScroll":"mousewheel",R=!!window.addEventListener,T=!!he.attachEvent;function le(s,e){return e.__mouseWheelWrapper=t=>{t=t||window.event,R&&t.preventDefault(),T&&(t.returnValue=!1),(v=="DOMMouseScroll"||v=="mousewheel")&&(t.delta=t.wheelDelta?t.wheelDelta/120:-(t.detail||0)/3),e.call(s,t)}}function de(s,e){const t=le(s,e);R?s.addEventListener(v,t,!1):T&&s.attachEvent("on"+v,t)}function ce(s,e){R?s.removeEventListener(v,e.__mouseWheelWrapper,!1):T&&s.detachEvent("on"+v,e.__mouseWheelWrapper),delete e.__mouseWheelWrapper}function ue(s,e,t=[]){let n=!1,i=o=>{s&&s.call(e,o,...t),!n&&i&&F(i)};return F(i),()=>{i=null,n=!0}}const fe={longitude:0,latitude:0,fov:0},c="GLTFViewer \u5B9E\u4F8B\u4E22\u5931",pe=new G;class me{constructor(e,t){a(this,"scene");a(this,"renderer");a(this,"camera");a(this,"fov",0);a(this,"longitude",0);a(this,"latitude",0);a(this,"pointLight");a(this,"directionLight");a(this,"ambientLight");a(this,"needsRender",!1);a(this,"__interiaMovement");a(this,"__lastPanPoint");a(this,"target");a(this,"__pinchCurrentFov");a(this,"dispose");a(this,"callbacks");a(this,"config");this.config=Object.assign({maxFov:120,minFov:1,logarithmicDepthBuffer:!0},e),this.callbacks=t;const n=e.initial||{};if(n.fov!==void 0&&(this.fov=n.fov),n.latitude!==void 0&&(this.latitude=n.latitude),n.longitude!==void 0&&(this.longitude=n.longitude),this.scene=new j,e.backgroundColor&&(this.scene.background=e.backgroundColor),this.renderer=new $({antialias:e.antialias,alpha:!0,logarithmicDepthBuffer:e.logarithmicDepthBuffer}),this.renderer.outputEncoding=H,e.toneMapping){const{toneMapping:r,toneMappingExposure:h}=e.toneMapping;r&&(this.renderer.toneMapping=r),h!==void 0&&(this.renderer.toneMappingExposure=h)}if(e.backgroundColor&&this.renderer.setClearColor(e.backgroundColor,0),e.pixelRatio&&this.renderer.setPixelRatio(e.pixelRatio),this.camera=new V(this.fov,1,.1,1500),e.pointLight!==!1&&(this.pointLight=e.pointLight||new z(268435455,1,1500),this.scene.add(this.pointLight)),e.directionalLight!==!1&&(this.directionLight=e.directionalLight||new Y(268435455,.1),this.directionLight.position.setY(-1),this.scene.add(this.directionLight)),e.ambientLight!==!1&&(this.ambientLight=e.ambientLight||new U(268435455),this.scene.add(this.ambientLight)),e.backgroundHDR){const r=new K(this.renderer),h=new X;h.setDataType(J),h.load(e.backgroundHDR,d=>{const u=r.fromEquirectangular(d);this.scene.environment=u.texture,e.backgroundColor&&(this.scene.background=u.texture),d.dispose(),r.dispose(),this.needsRender=!0}),r.compileEquirectangularShader()}this.__interiaMovement=!1;const i=new x.Manager(this.element);i.add(new x.Pan({threshold:0,pointers:0})),i.add(new x.Pinch({threshold:0,pointers:2}).recognizeWith(i.get("pan"))),i.on("panstart pan",this.__onPanGesture.bind(this)),i.on("pinchstart pinch pinchend",this.__onPinchGesture.bind(this));const o=this.__onMouseWheel.bind(this);de(this.element,o),this.dispose=()=>{i.destroy(),ce(this.element,o),this.clear(),this.renderer.dispose()},this.needsRender=!0,this.play()}get minFov(){return this.config.minFov||1}get maxFov(){return this.config.maxFov||120}pause(){}clear(){this.target&&(this.scene.remove(this.target.scene),this.update(fe),this.target=void 0)}play(){this.pause();const e=()=>{this.needsRender!==!1&&this.render(),this.needsRender=!1};this.pause=ue(e),e()}setTarget(e){this.target&&this.scene.remove(this.target.scene),this.target=e,this.target.scene.visible=!1,this.scene.add(this.target.scene),setTimeout(()=>{e===this.target&&(this.target.scene.visible=!0,this.update({}),this.callbacks.loaded(e,this.scene,this.renderer))},50)}get element(){return this.renderer.domElement}appendTo(e,t){e.appendChild(this.element),this.refresh(t);const n=window.getComputedStyle(e).position;n!=="relative"&&n!=="absolute"&&n!=="fixed"&&n!=="sticky"&&(e.style.position="relative")}refresh(e={}){const n=this.element.parentElement;if(!!n){if(n&&n.tagName&&n.nodeName){const{width:i=n.offsetWidth,height:o=n.offsetHeight}=e;this.renderer.setSize(i,o),this.camera.aspect=i/o,this.camera.updateProjectionMatrix()}this.needsRender=!0}}update(e){let t=this.fov,n=this.longitude,i=this.latitude;if(e.fov!==void 0&&(t=e.fov),e.longitude!==void 0&&(n=e.longitude),e.latitude!==void 0&&(i=e.latitude),!this.target||!this.target.scene)return;const o=new Q(this.target.scene,2865322),{center:r,radius:h}=o.geometry.boundingSphere||{};if(!r||!h)return;const d=new Z;d.expandByObject(this.target.scene),d.getCenter(r),n=D(n),i=Math.max(-Math.PI/2+.01,Math.min(+Math.PI/2,i));const u=h/Math.sin(Math.PI/4)*3,g=O({longitude:n,latitude:i});if(g.setLength(u),this.camera.position.copy(r.clone().add(g)),this.camera.lookAt(r),this.pointLight){const M=O({longitude:n,latitude:-Math.PI/6});M.setLength(u*3),this.pointLight.position.copy(r.clone().add(M))}const p=(M,W,C)=>{const S=C<1?W/C:W;return Math.atan(S/M/2)*2*(180/Math.PI)},f=this.camera.position.distanceTo(r);t===0&&(t=p(f,h*2,this.renderer.domElement.offsetWidth/this.renderer.domElement.offsetHeight)),t=Math.max(this.minFov,Math.min(this.maxFov,t)),t!==this.fov&&(this.camera.fov=t,this.camera.updateProjectionMatrix());const _=this.fov!==t||this.longitude!==n||this.latitude!==i;Object.assign(this,{longitude:n,latitude:i,fov:t}),this.needsRender=!0,_&&this.callbacks.stateChange({longitude:n,latitude:i,fov:t})}__onPanGesture(e){this.__interiaMovement=!1;const{longitude:t,latitude:n}=this,{center:i,isFinal:o,velocityX:r,velocityY:h,pointers:d}=e,u=(()=>this.__lastPanPoint&&this.__lastPanPoint.pointerLength===d.length?{x:i.x-this.__lastPanPoint.x,y:i.y-this.__lastPanPoint.y}:{x:0,y:0})();if(o)delete this.__lastPanPoint,I(g=>{this.__interiaMovement=!0;let p=r*g,f=h*g;const _=Math.sqrt(p*p+f*f);_>100&&(p=p/_*100,f=f/_*100),Math.abs(f/p)<Math.tan(20/180*Math.PI)&&(f=0),this.__requestInteriaMovement({x:p,y:f})});else{const g={width:this.element.offsetWidth,height:this.element.offsetHeight};this.update(N({longitude:t,latitude:n},u,g)),this.__lastPanPoint={pointerLength:d.length,x:i.x,y:i.y}}}__onPinchGesture(e){this.__interiaMovement=!1;const{scale:t,type:n}=e;if(n==="pinchstart"){this.__pinchCurrentFov=this.fov;return}if(n==="pinchend"){this.__pinchCurrentFov=void 0;return}const i=this.__pinchCurrentFov?this.__pinchCurrentFov/t:1;this.update({fov:i})}__requestInteriaMovement(e){if(this.__interiaMovement===!1)return;const{x:t,y:n}=e,{longitude:i,latitude:o}=this,r=.9,h={width:this.element.offsetWidth,height:this.element.offsetHeight};this.update(N({longitude:i,latitude:o},{x:t,y:n},h)),Math.abs(t)>1||Math.abs(n)>1?requestAnimationFrame(()=>this.__requestInteriaMovement({x:t*r,y:n*r*.7})):this.__interiaMovement=!1}__onMouseWheel(e){this.__interiaMovement=!1;const t=this.fov-e.delta;this.update({fov:t<=1?1:t})}load(e){return new Promise((t,n)=>{this.callbacks.willLoad(),pe.load(e,i=>{this.setTarget(i),t(!0)},i=>{this.callbacks.progressing(i.loaded/i.total*100)},i=>{this.callbacks.loadError(i),n(i)})})}render(){this.renderer.render(this.scene,this.camera)}}const l={};class ge extends re{constructor(e){super();a(this,"uuid",se());const t=new me(e,{stateChange:n=>this.emit("stateChange",n),progressing:n=>this.emit("progressing",n),willLoad:()=>this.emit("willLoad"),loaded:(n,i,o)=>this.emit("loaded",n,i,o),loadError:n=>this.emit("loadError",n)});Object.assign(window,{$controller:t}),l[this.uuid]=t}get state(){const e=l[this.uuid];if(!e)throw new Error(c);return new Proxy({fov:e.fov,latitude:e.latitude,longitude:e.longitude},{set:function(n,i,o){if(i==="fov"){if(isNaN(Number(o)))throw new TypeError("The fov is not an number");if(o>e.maxFov||o<e.minFov)throw new RangeError(`The fov seems invalid~ fov: [${e.minFov}, ${e.maxFov}]`)}return e.update({[i]:o}),!0},get:function(n,i){return e[i]}})}set state({fov:e,latitude:t,longitude:n}){const i=l[this.uuid];if(!i)throw new Error(c);i.update({fov:e===void 0?i.fov:e,latitude:t===void 0?i.latitude:t,longitude:n===void 0?i.longitude:n})}set minFov(e){const t=l[this.uuid];if(!t)throw new Error(c);t.config.minFov=e,t.update({})}get minFov(){const e=l[this.uuid];if(!e)throw new Error(c);return e.minFov}set maxFov(e){const t=l[this.uuid];if(!t)throw new Error(c);t.config.maxFov=e,t.update({})}get maxFov(){const e=l[this.uuid];if(!e)throw new Error(c);return e.maxFov}load(e){const t=l[this.uuid];if(!t)throw new Error(c);t.load(e)}appendTo(e,t){const n=l[this.uuid];if(!n)throw new Error(c);n.appendTo(e,t)}refresh(e){const t=l[this.uuid];if(!t)throw new Error(c);t.refresh(e)}dispose(){const e=l[this.uuid];if(!e)throw new Error(c);e.dispose&&e.dispose(),delete l[this.uuid]}fitFov(){const e=l[this.uuid];if(!e)throw new Error(c);e.update({fov:0})}}const E=ee.exports.jsx;function ve(){const s=k.exports.useRef(null);return k.exports.useEffect(()=>{const e=new ge({});Object.assign(window,{$glTFViewer:e}),s.current&&e.appendTo(s.current),(async()=>{await e.load("//cdn.glitch.me/36cb8393-65c6-408d-a538-055ada20431b/Astronaut.glb")})()}),E("div",{className:"App",children:E("div",{className:"gltf-viewer",ref:s})})}te.render(E(ie.StrictMode,{children:E(ve,{})}),document.getElementById("root"));
